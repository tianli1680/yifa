name: 更新播放列表

# 设置触发条件
on:
  # 每6小时触发一次
  schedule:
    - cron: '0 */6 * * *'
  # 允许手动触发
  workflow_dispatch:

# 赋予工作流读写仓库内容的权限
permissions:
  contents: write

jobs:
  update-file:
    runs-on: ubuntu-latest
    
    steps:
      # 步骤1：检出仓库代码
      - name: 检出仓库
        uses: actions/checkout@v4
      
      # 步骤2：从URL下载播放列表内容
      - name: 下载播放列表
        run: |
          echo "正在从源URL获取播放列表..."
          # 使用curl下载内容，-L处理重定向，-f让失败时退出
          curl -L -f -o yifa.txt "https://tvv.tw/github.com/fafa002/yf2025/blob/main/yiyifafa.txt"
          echo "下载完成，文件内容预览（前5行）："
          head -n 5 yifa.txt
      
      # 步骤3：检查文件是否有变化并提交
      - name: 提交更新
        run: |
          # 配置git用户
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # 检查文件是否有变化
          if git diff --quiet yifa.txt; then
            echo "文件无变化，无需提交"
          else
            echo "文件已更新，准备提交..."
            git add yifa.txt
            git commit -m "自动更新播放列表 - $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "✅ 更新已推送至仓库"
          fi
